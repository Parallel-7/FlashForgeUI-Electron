<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Settings</title>
    <link rel="stylesheet" href="settings.css" />
    <script src="../../../node_modules/lucide/dist/umd/lucide.min.js"></script>
    <script src="../../../dist/renderer/lucide.bundle.js"></script>
</head>
<body>
<div class="dialog-container dialog-container--full">
    <!-- Header -->
    <div class="dialog-header">
        <div class="dialog-title">Settings</div>
        <button class="dialog-close" id="btn-close" aria-label="Close">
            <i data-lucide="x" aria-hidden="true"></i>
        </button>
    </div>

    <!-- Content -->
    <div class="dialog-content">
        <div class="settings-header">
            <div id="printer-context-indicator" class="printer-context-indicator" aria-live="polite"></div>
        </div>

        <nav class="settings-tabs" role="tablist" aria-label="Settings categories">
            <button class="settings-tab-button" role="tab" id="tab-button-camera" data-tab="camera" aria-controls="tab-panel-camera" aria-selected="true">
                Camera
            </button>
            <button class="settings-tab-button" role="tab" id="tab-button-notifications" data-tab="notifications" aria-controls="tab-panel-notifications" aria-selected="false" tabindex="-1">
                Notifications
            </button>
            <button class="settings-tab-button" role="tab" id="tab-button-network" data-tab="network" aria-controls="tab-panel-network" aria-selected="false" tabindex="-1">
                Network
            </button>
            <button class="settings-tab-button" role="tab" id="tab-button-appearance" data-tab="appearance" aria-controls="tab-panel-appearance" aria-selected="false" tabindex="-1">
                Appearance
            </button>
            <button class="settings-tab-button" role="tab" id="tab-button-advanced" data-tab="advanced" aria-controls="tab-panel-advanced" aria-selected="false" tabindex="-1">
                Advanced
            </button>
            <button class="settings-tab-button" role="tab" id="tab-button-printer" data-tab="printer" aria-controls="tab-panel-printer" aria-selected="false" tabindex="-1">
                Printer Settings
            </button>
        </nav>

        <div class="tab-panels">
            <section id="tab-panel-camera" class="tab-panel" role="tabpanel" aria-labelledby="tab-button-camera">
                <h3 class="tab-panel-title">Camera and Streaming</h3>
                <div class="settings-section">
                    <div class="input-group">
                        <label for="camera-proxy-port">Camera Proxy Port:</label>
                        <input type="number" id="camera-proxy-port" class="settings-input" min="1" max="65535" placeholder="8181">
                    </div>
                    <div class="settings-info-text">
                        Port for the camera proxy used by both the app and Web UI.
                    </div>
                </div>

                <div id="camera-printer-empty-state" class="settings-info-text" hidden>
                    Connect to a printer to configure per-printer camera options.
                </div>

                <div id="camera-printer-settings" class="camera-printer-settings">
                    <div class="settings-info-text">
                        Camera overrides below apply to the active printer only.
                    </div>

                    <div class="settings-section">
                        <label class="checkbox-label">
                            <input type="checkbox" id="custom-camera"> Custom Camera
                        </label>
                        <div class="input-group">
                            <label for="custom-camera-url">Camera URL:</label>
                            <input type="text" id="custom-camera-url" class="settings-input" placeholder="http://...">
                        </div>
                    </div>

                    <div class="settings-section">
                        <h4 class="section-title">RTSP Stream Configuration</h4>
                        <div class="settings-info-text">
                            Settings for RTSP camera streams. Applies to RTSP URLs (rtsp://...). Changes take effect on next connection.
                        </div>
                        <div class="input-group">
                            <label for="rtsp-frame-rate">Frame Rate (FPS):</label>
                            <input type="number" id="rtsp-frame-rate" class="settings-input" min="1" max="60" value="30">
                        </div>
                        <div class="settings-info-text">
                            1-60 fps (default: 30). Lower values reduce bandwidth usage.
                        </div>

                        <div class="input-group">
                            <label for="rtsp-quality">Quality (1-5):</label>
                            <input type="number" id="rtsp-quality" class="settings-input" min="1" max="5" value="3">
                        </div>
                        <div class="settings-info-text">
                            1 = best quality (largest bandwidth), 5 = lowest quality (default: 3).
                        </div>
                    </div>
                </div>
            </section>

            <section id="tab-panel-notifications" class="tab-panel" role="tabpanel" aria-labelledby="tab-button-notifications" hidden>
                <h3 class="tab-panel-title">Notifications and Alerts</h3>
                <div class="settings-section">
                    <label class="checkbox-label">
                        <input type="checkbox" id="discord-sync"> Discord Sync
                    </label>
                    <div class="input-group">
                        <label for="webhook-url">Discord Webhook:</label>
                        <input type="text" id="webhook-url" class="settings-input" placeholder="https://discord.com/api/webhooks/...">
                    </div>
                    <div class="input-group">
                        <label for="discord-update-interval">Discord Update Interval (minutes):</label>
                        <input type="number" id="discord-update-interval" class="settings-input" min="1" max="60" placeholder="5">
                    </div>
                    <button id="btn-test-discord" class="settings-action-button">Test Discord Webhook</button>
                    <div id="discord-test-result" class="settings-info-text" style="margin-top: 8px;"></div>
                </div>

                <div class="settings-section">
                    <label class="checkbox-label">
                        <input type="checkbox" id="alert-when-complete"> Alert On Complete
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="alert-when-cooled"> Alert On Cooled
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="visual-alerts"> Visual Alerts
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="audio-alerts"> Audio Alerts
                    </label>
                </div>
            </section>

            <section id="tab-panel-network" class="tab-panel" role="tabpanel" aria-labelledby="tab-button-network" hidden>
                <h3 class="tab-panel-title">Network Services</h3>
                <div class="settings-section">
                    <label class="checkbox-label">
                        <input type="checkbox" id="web-ui"> Web UI
                    </label>
                    <div class="input-group">
                        <label for="web-ui-port">Web UI Port:</label>
                        <input type="number" id="web-ui-port" class="settings-input" min="1" max="65535" placeholder="3000">
                    </div>
                    <div class="input-group">
                        <label for="web-ui-password">Web UI Password:</label>
                        <input type="password" id="web-ui-password" class="settings-input" placeholder="changeme">
                    </div>
                    <label class="checkbox-label">
                        <input type="checkbox" id="web-ui-password-required" checked> Require Web UI Password (recommended)
                    </label>
                    <div class="settings-info-text">
                        Disable this setting only on trusted networks. When unchecked, anyone on your network can access the Web UI without logging in.
                    </div>
                </div>

        <div class="settings-section">
                    <label class="checkbox-label">
                        <input type="checkbox" id="filament-tracker-enabled"> Filament Tracker Integration
                    </label>
                    <div class="settings-info-text">
                        Enable HTTP API endpoints for integration with filament-tracker-electron application. Uses the Web UI port.
                    </div>
                    <div class="input-group">
                        <label for="filament-tracker-api-key">Filament Tracker API Key (Optional):</label>
                        <input type="text" id="filament-tracker-api-key" class="settings-input" placeholder="Leave empty for no authentication">
                    </div>
                    <div class="settings-info-text">
                        Optional API key for authentication. If set, external applications must include this key in the x-api-key header.
                    </div>
                </div>

                <div class="settings-section">
                    <h4 class="section-title">Spoolman Integration</h4>
                    <div class="settings-info-text">
                        Connect to your Spoolman server to automatically track filament usage across all your printers.
                    </div>

                    <label class="checkbox-label">
                        <input type="checkbox" id="spoolman-enabled"> Enable Spoolman Integration
                    </label>

                    <div class="input-group">
                        <label for="spoolman-server-url">Spoolman Server URL:</label>
                        <input type="text"
                               id="spoolman-server-url"
                               class="settings-input"
                               placeholder="http://192.168.1.10:7912">
                    </div>
                    <div class="settings-info-text">
                        Full URL including http:// or https:// and port (e.g., http://192.168.1.10:7912)
                    </div>

                    <button id="btn-test-spoolman" class="settings-action-button">Test Spoolman Connection</button>
                    <div id="spoolman-test-result" class="settings-info-text" style="margin-top: 8px;"></div>

                    <div class="input-group">
                        <label for="spoolman-update-mode">Filament Update Mode:</label>
                        <select id="spoolman-update-mode" class="settings-input">
                            <option value="weight">Weight (grams)</option>
                            <option value="length">Length (millimeters)</option>
                        </select>
                    </div>
                    <div class="settings-info-text">
                        Choose whether to update Spoolman using filament weight or length after prints complete
                    </div>
                </div>
            </section>

            <section id="tab-panel-appearance" class="tab-panel" role="tabpanel" aria-labelledby="tab-button-appearance" hidden>
                <h3 class="tab-panel-title">Appearance</h3>
                <div class="settings-section">
                    <label class="checkbox-label">
                        <input type="checkbox" id="always-on-top"> Always On Top
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="rounded-ui"> Rounded UI
                    </label>
                    <div class="settings-info-text">
                        Enable rounded windows and dialogs. Restart required after changing.
                        <span class="rounded-ui-warning" style="display: none; color: #ff9800; font-weight: 500; align-items: center; gap: 6px;">
                            <i data-lucide="alert-triangle" aria-hidden="true"></i>
                            <span class="rounded-ui-warning-text">Rounded UI is not available on this platform.</span>
                        </span>
                    </div>
                </div>

                <div class="settings-section">
                    <h4 class="section-title">Desktop Theme Colors</h4>
                    <div class="settings-info-text">
                        Customize the color scheme for the desktop application
                    </div>

                    <div class="theme-colors-grid">
                        <div class="theme-color-card" data-color-key="primary">
                            <div class="color-card-header">
                                <span class="color-label">Primary Color</span>
                                <input type="text" class="hex-input" id="hex-primary" placeholder="#4285f4" maxlength="7">
                            </div>
                            <div class="color-preview-container">
                                <button type="button" class="color-swatch" id="swatch-primary" aria-label="Pick primary color"></button>
                                <input type="color" id="desktop-theme-primary" class="native-color-picker" tabindex="-1">
                            </div>
                        </div>

                        <div class="theme-color-card" data-color-key="secondary">
                            <div class="color-card-header">
                                <span class="color-label">Secondary Color</span>
                                <input type="text" class="hex-input" id="hex-secondary" placeholder="#357abd" maxlength="7">
                            </div>
                            <div class="color-preview-container">
                                <button type="button" class="color-swatch" id="swatch-secondary" aria-label="Pick secondary color"></button>
                                <input type="color" id="desktop-theme-secondary" class="native-color-picker" tabindex="-1">
                            </div>
                        </div>

                        <div class="theme-color-card" data-color-key="background">
                            <div class="color-card-header">
                                <span class="color-label">Background Color</span>
                                <input type="text" class="hex-input" id="hex-background" placeholder="#121212" maxlength="7">
                            </div>
                            <div class="color-preview-container">
                                <button type="button" class="color-swatch" id="swatch-background" aria-label="Pick background color"></button>
                                <input type="color" id="desktop-theme-background" class="native-color-picker" tabindex="-1">
                            </div>
                        </div>

                        <div class="theme-color-card" data-color-key="surface">
                            <div class="color-card-header">
                                <span class="color-label">Surface Color</span>
                                <input type="text" class="hex-input" id="hex-surface" placeholder="#1e1e1e" maxlength="7">
                            </div>
                            <div class="color-preview-container">
                                <button type="button" class="color-swatch" id="swatch-surface" aria-label="Pick surface color"></button>
                                <input type="color" id="desktop-theme-surface" class="native-color-picker" tabindex="-1">
                            </div>
                        </div>

                        <div class="theme-color-card" data-color-key="text">
                            <div class="color-card-header">
                                <span class="color-label">Text Color</span>
                                <input type="text" class="hex-input" id="hex-text" placeholder="#e0e0e0" maxlength="7">
                            </div>
                            <div class="color-preview-container">
                                <button type="button" class="color-swatch" id="swatch-text" aria-label="Pick text color"></button>
                                <input type="color" id="desktop-theme-text" class="native-color-picker" tabindex="-1">
                            </div>
                        </div>
                    </div>

                    <button id="reset-desktop-theme" class="settings-action-button">Reset to Default Theme</button>
                </div>

                <!-- Custom Color Picker Modal -->
                <div id="custom-color-picker" class="color-picker-modal" hidden>
                    <div class="color-picker-overlay"></div>
                    <div class="color-picker-dialog">
                        <div class="color-picker-header">
                            <h5 class="color-picker-title">Choose Color</h5>
                            <button type="button" class="color-picker-close" aria-label="Close color picker">&times;</button>
                        </div>
                        <div class="color-picker-body">
                            <canvas id="color-picker-canvas" width="200" height="200"></canvas>
                            <div class="color-picker-controls">
                                <div class="brightness-slider-container">
                                    <label for="brightness-slider">Brightness</label>
                                    <input type="range" id="brightness-slider" min="0" max="100" value="100">
                                </div>
                                <div class="hex-input-container">
                                    <label for="picker-hex-input">Hex</label>
                                    <input type="text" id="picker-hex-input" class="hex-input" placeholder="#000000" maxlength="7">
                                </div>
                                <div class="color-preview-large">
                                    <div id="picker-preview-swatch"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="tab-panel-advanced" class="tab-panel" role="tabpanel" aria-labelledby="tab-button-advanced" hidden>
                <h3 class="tab-panel-title">Advanced</h3>
                <div class="settings-section">
                    <label class="checkbox-label">
                        <input type="checkbox" id="debug-mode"> Debug Mode
                    </label>
                </div>

                <div class="settings-section">
                    <h4 class="section-title">Auto-Update Settings</h4>
                    <label class="checkbox-label">
                        <input type="checkbox" id="check-updates-on-launch"> Check for updates on launch
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="auto-download-updates"> Auto-download updates (Windows/macOS)
                    </label>
                    <div class="input-group">
                        <label for="update-channel">Update channel:</label>
                        <select id="update-channel" class="settings-input">
                            <option value="stable">Stable (recommended)</option>
                            <option value="alpha">Alpha (pre-release)</option>
                        </select>
                    </div>
                    <div class="settings-info-text">
                        Alpha channel receives new features sooner and may be unstable. Switching back to stable waits for the next production release.
                    </div>
                    <button id="btn-check-updates" class="settings-action-button">Check for Updates Now</button>
                    <div id="update-check-result" class="settings-info-text" style="margin-top: 8px;"></div>
                </div>
            </section>

            <section id="tab-panel-printer" class="tab-panel" role="tabpanel" aria-labelledby="tab-button-printer" hidden>
                <h3 class="tab-panel-title">Per-Printer Overrides</h3>
                <div id="printer-settings-empty-state" class="settings-info-text" hidden>
                    Connect to a printer to configure per-printer options.
                </div>

                <div id="printer-settings-content" class="printer-settings-content">
                    <div class="settings-info-text">
                        These settings apply to the active printer only.
                    </div>

                    <div class="settings-section">
                        <label class="checkbox-label">
                            <input type="checkbox" id="custom-leds"> Custom LEDs
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="force-legacy-api"> Force Legacy API
                        </label>
                        <div class="settings-info-text">
                            When enabled, the application will use the legacy TCP API even for 5M/Pro printers.
                            Requires reconnection to take effect.
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Footer -->
    <div class="dialog-footer">
        <span id="save-status" class="save-status"></span>
        <div class="dialog-buttons">
            <button class="dialog-button cancel" id="btn-close-footer">Close</button>
            <button class="dialog-button primary" id="btn-save">Save</button>
        </div>
    </div>
</div>
<script src="../../../dist/renderer/settings-renderer.bundle.js"></script>
</body>
</html>
